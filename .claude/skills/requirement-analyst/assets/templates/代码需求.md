# 代码需求文档

> 生成时间：YYYY-MM-DD

---

## 技术栈

| 项目 | 选择 |
|------|------|
| 游戏引擎 | [如：Cocos Creator 3.x / Unity / Godot] |
| 编程语言 | [如：TypeScript / C# / GDScript] |
| 版本控制 | Git |

---

## 核心系统

### 系统清单

| ID | 系统名称 | 描述 | 优先级 |
|----|----------|------|--------|
| sys_001 | 游戏管理器 | 游戏流程控制 | P0 |
| sys_002 | 输入管理器 | 输入统一处理 | P0 |
| sys_003 | 场景管理器 | 场景切换控制 | P0 |
| sys_004 | 对话系统 | 对话显示与交互 | P0 |
| sys_005 | 战斗系统 | 战斗逻辑处理 | P0 |
| sys_006 | 存档系统 | 数据持久化 | P1 |
| sys_007 | 音频系统 | 音频播放控制 | P1 |

---

## 系统详细需求

### 游戏管理器 (GameManager)

**功能描述：** 游戏整体流程控制，状态管理

**状态定义：**
| 状态 | 说明 |
|------|------|
| LOADING | 加载中 |
| MENU | 主菜单 |
| PLAYING | 游戏中 |
| DIALOG | 对话中 |
| PAUSED | 暂停 |
| GAMEOVER | 游戏结束 |

**接口需求：**
```typescript
// 示例接口定义
interface GameManager {
    // 获取当前状态
    getState(): GameState;

    // 切换状态
    changeState(state: GameState): void;

    // 切换场景
    loadScene(sceneName: string): void;

    // 暂停/恢复游戏
    pause(): void;
    resume(): void;
}
```

---

### 输入管理器 (InputManager)

**功能描述：** 统一处理键盘、鼠标输入

**输入映射：**
| 动作 | 默认按键 | 说明 |
|------|----------|------|
| move_up | W / ↑ | 向上移动 |
| move_down | S / ↓ | 向下移动 |
| move_left | A / ← | 向左移动 |
| move_right | D / → | 向右移动 |
| dodge | Space | 闪避/翻滚 |
| attack | LeftMouse | 普通攻击 |
| skill_1 | Q | 技能1 |
| skill_2 | E | 技能2 |
| ultimate | RightMouse | 终极技能 |
| reload | R | 换弹/冥想 |
| interact | F | 交互/拾取 |

**接口需求：**
```typescript
interface InputManager {
    // 获取移动方向
    getMovement(): Vector2;

    // 获取鼠标位置
    getMousePosition(): Vector2;

    // 检测按键状态
    isKeyPressed(action: string): boolean;
    isKeyDown(action: string): boolean;
    isKeyUp(action: string): boolean;

    // 注册回调
    onAction(action: string, callback: Function): void;
}
```

---

### 战斗系统 (CombatSystem)

**功能描述：** 处理战斗逻辑、伤害计算

**核心功能：**
| 功能 | 描述 |
|------|------|
| 伤害计算 | 基础伤害、暴击、防御减伤 |
| 伤害类型 | 物理、魔法、真实伤害 |
| 状态效果 | 中毒、灼烧、减速等 |
| 范围检测 | 单体、范围、扇形 |

**伤害公式：**
```
最终伤害 = 基础伤害 × (1 - 防御减伤率) × 暴击倍率 × 抗性系数
防御减伤率 = 防御力 / (防御力 + 100)
```

**接口需求：**
```typescript
interface CombatSystem {
    // 造成伤害
    dealDamage(attacker: Unit, target: Unit, damage: DamageData): DamageResult;

    // 治疗
    heal(target: Unit, amount: number): void;

    // 应用状态效果
    applyEffect(target: Unit, effect: StatusEffect): void;

    // 范围伤害
    dealAreaDamage(center: Vector2, radius: number, damage: DamageData): void;
}
```

---

### 对话系统 (DialogSystem)

**功能描述：** 处理对话显示、选项、跳转

**核心功能：**
| 功能 | 描述 |
|------|------|
| 对话显示 | 打字机效果、角色名、头像 |
| 选项分支 | 多选项对话分支 |
| 条件检测 | 根据条件显示/跳转 |
| 事件触发 | 对话中触发事件 |

**数据结构：**
```typescript
interface DialogData {
    id: string;
    sections: DialogSection[];
}

interface DialogSection {
    id: string;
    lines: DialogLine[];
    options?: DialogOption[];
}

interface DialogLine {
    speaker: string;
    text: string;
    portrait?: string;
    effects?: DialogEffect[];
}
```

---

## 组件需求

### 角色组件 (Character)

| 功能 | 描述 |
|------|------|
| 属性管理 | HP、MP、ATK、DEF、SPD等 |
| 移动控制 | 方向移动、速度控制 |
| 动画控制 | 状态机驱动的动画切换 |
| 战斗功能 | 攻击、受伤、死亡 |

### 敌人AI组件 (EnemyAI)

| 功能 | 描述 |
|------|------|
| 巡逻 | 默认巡逻行为 |
| 追击 | 检测到玩家后追击 |
| 攻击 | 攻击范围内的攻击行为 |
| 逃跑 | 低血量时的逃跑行为 |

---

## 数据配置需求

### 配置文件清单

| 文件名 | 用途 | 格式 |
|--------|------|------|
| game_config.json | 游戏全局配置 | JSON |
| characters.json | 角色属性配置 | JSON |
| enemies.json | 敌人属性配置 | JSON |
| skills.json | 技能数据配置 | JSON |
| items.json | 物品数据配置 | JSON |
| dialogs/ | 对话数据目录 | JSON |

---

## 目录结构

```
project/
├── scripts/
│   ├── core/           # 核心系统
│   │   ├── GameManager.ts
│   │   ├── InputManager.ts
│   │   ├── SceneManager.ts
│   │   ├── DialogManager.ts
│   │   ├── CombatSystem.ts
│   │   └── AudioManager.ts
│   ├── components/     # 组件
│   │   ├── Character.ts
│   │   ├── EnemyAI.ts
│   │   └── Interactable.ts
│   ├── scenes/         # 场景脚本
│   │   └── [SceneName].ts
│   ├── ui/             # UI组件
│   │   ├── DialogUI.ts
│   │   ├── BattleUI.ts
│   │   └── MenuUI.ts
│   └── data/           # 数据结构
│       └── types.ts
├── resources/
│   ├── data/           # 配置文件
│   ├── prefabs/        # 预制体
│   └── scenes/         # 场景文件
└── assets/
    ├── sprites/        # 精灵图
    ├── audio/          # 音频
    └── fonts/          # 字体
```

---

## 开发优先级

| 阶段 | 内容 | 系统依赖 |
|------|------|----------|
| P0 | 核心系统 + 基础战斗 | - |
| P1 | 对话系统 + UI系统 | P0 |
| P2 | 存档系统 + 完整战斗 | P0, P1 |
| P3 | 优化 + 扩展功能 | P0, P1, P2 |
